<!DOCTYPE html>
<html>
<head>
  <title>Weather App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { text-align: center; padding-top: 50px; }
    .weather { margin-top: 30px; }
    .history { margin-top: 20px; }
    .toggle-btn { cursor: pointer; font-weight: bold; color: #0d6efd; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Weather App</h1>

    <form method="POST" action="/" class="mb-4">
      <div class="input-group justify-content-center">
        <input type="text" name="city" placeholder="Enter city" class="form-control w-50" required>
        <button type="submit" class="btn btn-primary">Get Weather</button>
      </div>
    </form>

    <% if(weather) { %>
      <div class="weather card mx-auto p-4 w-50 shadow">
        <h2><%= weather.name %>, <%= weather.country %></h2>
        <h5 id="datetime"></h5>
        <h3><span id="temp"><%= weather.tempC %></span>°C</h3>
        <p><span class="toggle-btn" onclick="toggleTemp()">Toggle °C/°F</span></p>
        <p>Wind Speed: <%= weather.windspeed %> km/h</p>
        <p><%= weather.icon %> <%= weather.description %></p>
      </div>
    <% } %>

    <% if(error) { %>
      <p class="text-danger mt-3"><%= error %></p>
    <% } %>

    <% if(history.length > 0) { %>
      <div class="history w-50 mx-auto">
        <h4>Recent Searches:</h4>
        <ul class="list-group">
          <% history.forEach(city => { %>
            <li class="list-group-item"><%= city %></li>
          <% }) %>
        </ul>
      </div>
    <% } %>
  </div>

  <script>
    // Temperature toggle
    let celsius = true;
    const tempC = <%= weather ? weather.tempC : 0 %>;
    const tempF = <%= weather ? weather.tempF : 0 %>;
    function toggleTemp() {
      const tempEl = document.getElementById('temp');
      if(celsius) {
        tempEl.innerText = tempF;
        celsius = false;
      } else {
        tempEl.innerText = tempC;
        celsius = true;
      }
    }

    // Display current time & date of the searched city
    <% if(weather) { %>
      function updateTime() {
        const datetimeEl = document.getElementById('datetime');
        const utcTime = new Date();
        const offsetHours = <%= weather.utc_offset || 0 %>; // we’ll calculate in server
        const cityTime = new Date(utcTime.getTime() + offsetHours * 3600 * 1000);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' };
        datetimeEl.innerText = cityTime.toLocaleString('en-US', options);
      }
      setInterval(updateTime, 1000);
      updateTime();
    <% } %>
  </script>
</body>
</html>

